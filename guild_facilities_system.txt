Guild Facilities & Holdings System Documentation
===============================================

Version: 1.0.0
Last Updated: 2025-01-23

OVERVIEW
========

The Guild Facilities & Holdings System enables guilds to construct, control, and benefit 
from physical buildings and operational sites. This system provides economic bonuses, 
defensive capabilities, reputation improvements, and special features that create 
dynamic gameplay opportunities and enhance guild operations.

CORE COMPONENTS
===============

1. GuildFacility Class
   - Physical representation of guild-controlled buildings
   - Location, status, and operational tracking
   - Damage, repair, and ownership mechanics
   - Economic bonus calculation and application

2. Facility Types
   - Guildhall: Administrative center and headquarters
   - Workshop: Crafting and production facility
   - Warehouse: Storage and trade logistics
   - Market Stall: Direct commerce and customer relations
   - Training Ground: Skill development and combat preparation
   - Academy: Education, research, and knowledge preservation
   - Forge: Metalworking and weapon crafting
   - Scriptorium: Scholarly work and magical scribing

3. Integration Functions
   - construct_guild_facility(): Building construction system
   - damage_or_capture_facility(): Conflict resolution mechanics
   - evaluate_facility_impact(): Settlement benefit calculation

KEY FEATURES
============

Dynamic Facility Management
---------------------------
- Construction with resource requirements and timeframes
- Condition tracking (0-100) affecting operational efficiency
- Status progression: Active → Damaged → Abandoned → Under Siege → Captured
- Maintenance cost accumulation and facility degradation
- Occupancy management with NPC worker assignment

Economic Impact System
----------------------
- Guild-type specific bonuses (merchants get trade efficiency, craftsmen get production)
- Settlement-wide benefits: reputation, defensive value, capacity increases
- Stability multipliers affecting bonus effectiveness
- Integration with existing economy and settlement systems

Conflict Integration
--------------------
- Facility damage during guild wars and faction conflicts
- Siege mechanics with reduced efficiency during attacks
- Ownership transfer through conquest or purchase
- Diplomatic consequences and reputation effects
- Integration with guild event system for narrative generation

PC Interaction Opportunities
-----------------------------
- Quest generation based on facility condition and status
- Repair quests for damaged facilities
- Siege-breaking missions for facilities under attack
- Recruitment drives for understaffed facilities
- Secret knowledge quests for facilities with special features

TECHNICAL SPECIFICATIONS
=========================

GuildFacility Class
-------------------
Core Attributes:
- facility_id: Unique identifier (UUID)
- name: Display name of the facility
- location: World coordinates (x, y tuple)
- settlement_id: ID of containing settlement
- facility_type: Type from FacilityType enum
- owning_guild_id: ID of controlling guild
- status: Current operational status
- construction_year: Year facility was built

Operational Attributes:
- condition: Current condition (0-100)
- reputation_bonus: Settlement reputation improvement
- economic_bonus: Dictionary of economic multipliers
- defensive_value: Military/conflict value
- special_features: List of unique facility capabilities
- max_capacity: Maximum occupant limit
- current_capacity: Current number of occupants
- maintenance_cost: Daily upkeep requirement
- accumulated_maintenance_debt: Outstanding maintenance costs

History Tracking:
- construction_events: Building and modification history
- operational_history: Usage and management events
- damage_events: Conflict and deterioration records
- occupants: List of NPC IDs using the facility

Methods:
- calculate_effective_bonuses(): Current bonus calculation considering condition/status
- apply_damage(): Damage application with consequence calculation
- get_summary(): Comprehensive facility status information

LocalGuild Integration
----------------------
Enhanced Attributes:
- facilities: List[str] - Facility IDs owned by guild
- headquarters: Optional[str] - Primary facility ID (usually guildhall)

The LocalGuild class has been extended to track facility ownership and 
designate headquarters for administrative purposes.

Facility Templates
------------------
Each facility type has predefined characteristics:

**Guildhall** (Administrative Center):
- Base Cost: 500 gold, Construction: 60 days
- Reputation Bonus: +10, Defensive Value: 25
- Economic Bonuses: Administration +15%, Recruitment +20%
- Special Features: Meeting hall, guild records, ceremonial chamber
- Capacity: 50 occupants

**Workshop** (Crafting Facility):
- Base Cost: 200 gold, Construction: 30 days
- Reputation Bonus: +5, Defensive Value: 5
- Economic Bonuses: Crafting +25%, Production Efficiency +15%
- Special Features: Specialized tools, materials storage
- Capacity: 15 occupants

**Warehouse** (Storage Facility):
- Base Cost: 300 gold, Construction: 45 days
- Reputation Bonus: +3, Defensive Value: 15
- Economic Bonuses: Storage Capacity +40%, Trade Efficiency +10%
- Special Features: Secure storage, loading dock
- Capacity: 5 occupants

**Academy** (Educational Institution):
- Base Cost: 800 gold, Construction: 90 days
- Reputation Bonus: +15, Defensive Value: 10
- Economic Bonuses: Education +40%, Research +25%, Knowledge Preservation +30%
- Special Features: Library, lecture halls, laboratories
- Capacity: 100 occupants

CORE FUNCTIONS
==============

construct_guild_facility()
---------------------------
**Purpose:** Create new guild facilities with proper integration
**Parameters:**
- guild: LocalGuild object that will own the facility
- facility_type: Type of facility to construct
- name: Display name for the facility
- location: World coordinates for placement
- settlement: Settlement where facility will be built
- year: Current game year

**Process:**
1. Creates GuildFacility object with specified parameters
2. Adds facility ID to guild's facilities list
3. Sets as headquarters if it's the first guildhall
4. Applies reputation bonus to settlement
5. Records construction in guild historical events
6. Returns constructed facility object

damage_or_capture_facility()
-----------------------------
**Purpose:** Handle facility damage and ownership changes during conflicts
**Parameters:**
- facility: GuildFacility to affect
- by_faction_or_guild: ID of attacking entity
- action_type: "damage", "capture", or "siege"
- damage_amount: Amount of damage to apply

**Consequences:**
- Guild Effects: Reputation loss, member loyalty reduction, stability decrease
- Settlement Effects: Stability loss, reputation changes
- Diplomatic Effects: Incident recording for future faction relations
- Facility Effects: Condition reduction, status changes, occupant evacuation

evaluate_facility_impact()
---------------------------
**Purpose:** Calculate cumulative benefits of guild facilities in a settlement
**Returns:** Dictionary of bonuses including:
- reputation_bonus: Settlement reputation improvement
- economic_multipliers: Production and efficiency bonuses by category
- defensive_value: Military/conflict capabilities
- trade_efficiency: Commerce and trade improvements
- recruitment_bonus: Guild member recruitment advantages

**Factors:**
- Guild stability affects all bonuses (capped at 80% efficiency)
- Guild type determines specific bonus categories
- Facility count estimated from guild member count
- Settlement integration through modifier application

INTEGRATION PATTERNS
=====================

Settlement System Integration
-----------------------------
Facilities provide multiple benefits to their host settlements:
- Reputation bonuses improve settlement-guild relations
- Economic multipliers enhance resource production
- Defensive value contributes to settlement security
- Capacity bonuses allow larger NPC populations
- Trade efficiency improvements boost commerce

Economy Tick Integration
------------------------
The facility system integrates with the economy tick through:
- Daily maintenance cost calculation and debt accumulation
- Condition degradation for unmaintained facilities
- Status transitions affecting operational efficiency
- Economic bonus application to settlement production
- Trade route and commerce enhancement

NPC Career Engine Integration
-----------------------------
Facilities provide employment and training opportunities:
- Workshop positions for craftsmen and artisans
- Academy slots for scholars and researchers
- Training ground positions for guards and warriors
- Administrative roles in guildhalls
- Specialized positions based on facility features

Faction System Integration
--------------------------
Facilities create diplomatic and conflict opportunities:
- Reputation changes affect faction relations
- Facility seizures create diplomatic incidents
- Defensive values contribute to conflict resolution
- Strategic targets for faction warfare
- Economic advantages in inter-faction competition

Rumor System Integration
------------------------
Facilities generate narrative content through:
- Construction announcements and completion celebrations
- Damage reports and siege situations
- Ownership changes and guild conflicts
- Special discoveries in academy libraries or workshop innovations
- Scandal and corruption stories involving guild operations

EXPANSION GUIDELINES
====================

Adding New Facility Types
--------------------------
1. Define facility template with appropriate costs and bonuses
2. Add to FacilityType enum for type safety
3. Create template entry in _get_facility_template()
4. Design special features and unique capabilities
5. Consider settlement tier requirements and restrictions
6. Plan integration with existing quest and event systems

Facility Upgrade System
------------------------
Future expansion could include:
- Upgrade paths for existing facilities (workshop → master workshop)
- Unlock requirements based on guild achievements
- Cost scaling and benefit improvements
- Multi-stage construction for complex facilities
- Prestige benefits for fully upgraded facility networks

Special Feature Expansion
--------------------------
Special features provide unique capabilities and quest opportunities:
- Hidden chambers for secret meetings and contraband storage
- Magical wards for enhanced defense and mystical research
- Underground networks connecting multiple facilities
- Artifact storage for legendary items and relics
- Training dummies and specialized equipment for skill development

PERFORMANCE CONSIDERATIONS
===========================

The Guild Facilities System is designed for efficiency:
- Template-based facility creation reduces object overhead
- Status-based bonus calculation prevents unnecessary computation
- Facility ID references minimize memory usage
- Event-driven updates rather than continuous monitoring
- Integration points designed for batch processing during economy ticks

Memory usage scales linearly with facility count, with each facility 
requiring approximately 2-5KB of memory for full state tracking.
Query performance remains sub-millisecond for typical guild facility 
collections (1-20 facilities per guild).

The system supports expansion to hundreds of guilds with thousands 
of total facilities while maintaining responsive performance for 
real-time gameplay requirements.

USAGE EXAMPLES
==============

Basic Facility Construction:
```python
# Create a new guildhall for a merchant guild
facility = construct_guild_facility(
    guild=merchants_guild,
    facility_type="guildhall",
    name="Golden Coin Hall",
    location=(150.0, 75.0),
    settlement=trading_town,
    year=1156
)
```

Conflict Resolution:
```python
# Damage facility during guild war
results = damage_or_capture_facility(
    facility=enemy_warehouse,
    by_faction_or_guild=attacking_guild.guild_id,
    action_type="damage",
    damage_amount=35.0
)
```

Settlement Benefit Calculation:
```python
# Calculate guild facility impact on settlement
bonuses = evaluate_facility_impact(
    settlement=capital_city,
    guild=craftsmen_guild
)
```

Quest Generation:
```python
# Generate repair quest for damaged facility
quests = get_facility_quest_opportunities(damaged_workshop)
for quest in quests:
    if quest['quest_type'] == 'facility_repair':
        # Create repair quest for players
        create_quest(quest)
```

This comprehensive system provides the foundation for rich guild-settlement 
interactions, dynamic conflict resolution, and emergent storytelling 
opportunities within the Age of Scribes simulation. 